# nft-survey

NFT survey

1. simpleNFT

参考資料: [https://qiita.com/mogiken/items/54bc24669068ecadf957](https://qiita.com/mogiken/items/54bc24669068ecadf957)

```sh
cd simpleNFT/packages/contracts
yarn install
# プロジェクトのルートに戻る
cd simpleNFT/packages/frontend
yarn install
# プロジェクトのルートに戻る
cd simpleNFT
yarn install
# 以下コマンドを実行すると、ETHのローカル開発用のノードと、ローカルのreactのフロントエンドのweb appが動作する
yarn dev
# MetaMaskの設定を適切に行った上で、フロントエンドの画面のボタンを順にクリックしていくと、consoleにcontractの情報等が適宜表示されていく

# テストネットへのコントラクトのデプロイやミント等を試す
# MetaMaskをあらかじめ希望のテストネットへ切り替えておく。MetaMask側でコントラクトのデプロイ先ネットワークをコントロールする形。ソースコードの側はほとんど変わらない。
yarn dev-staging
# MetaMaskをサイトへ接続(≒プライバシーモードを解除)し、フロントエンド画面のボタンを順にクリックしていく。ローカル開発時と異なり、Etherscanのアドレスが記録として表示されるので、正常にデプロイされているか、トランザクションは承認されたか等を適宜確認しつつ進める。
```

Rinkebyテストネットでの実行結果の記録

- コントラクトのデプロイ: [https://rinkeby.etherscan.io/tx/0xb47f248ddae64ab7f01386e92636f5750c2fe3d1d566f77c170630cf11c88941](https://rinkeby.etherscan.io/tx/0xb47f248ddae64ab7f01386e92636f5750c2fe3d1d566f77c170630cf11c88941)
- Mint: [https://rinkeby.etherscan.io/tx/0x16f3bba2bbce1f30d8296774ab23bd4c7f1db3a0fea960cacdc85ac9f42196f8](https://rinkeby.etherscan.io/tx/0x16f3bba2bbce1f30d8296774ab23bd4c7f1db3a0fea960cacdc85ac9f42196f8)

できた...のか？いまいち実感が湧いていない...

はまりどころ

- MetaMaskはデフォルトでプライバシーモード？になっているので、明示的にサイトに接続する処理をあらかじめ実行しておかねばエラーになる。
- hardhatで動作させたETHのローカル開発用ノードの場合、chain idをhardhatデフォルトの値？に参考資料の記述を参考に設定しておかねばエラーになった。
- 一旦、hardhatで動作させたETHのローカル開発用ノードを止めて、もう一度起動した場合、ノードの情報はリセットされるが、MetaMaskに保持されたNonceはリセットされないため、Nonceに矛盾が生じてエラーが起きた。MetaMaskで手動でNonce指定する方法ある？

疑問点

- 今のところ、どの参考資料も、ABIを取得するのに`.sol`ファイルをコンパイルした際にローカルに自動生成されたABIの情報が記載されたjsonファイルを読み込んで参照する方法を取っていたが...
  - コントラクトアドレスがわかっていた場合でも、コントラクトアドレスだけでは、ブロックチェーンネットワーク上の情報からABIを取得？復元？できないのか？(そんなことないはずと思っていたが、いまいち、それっぽい方法が見つからない。何か勘違いしているだけ？) -> Etherscan等で確認できるのでは？
  - もしそうなら、ユーザー各自、一人一人がコントラクトをデプロイするような場合、全ユーザーの全コントラクトのABIを、何らかの形でチェーン外でキープしておく必要があるのか？それとも何か勘違いしている？ -> 後述するように、サービス提供者がコントラクトをデプロイし、そのコントラクトを共通で使うことになるため、サービス提供者がコントラクトデプロイした際に手元に生成された情報をそのまま使えばよく、そもそもあまり深く考える必要はなさそう。
- MetaMaskのプライバシーモードの解除は、各サイト毎に行う必要がありそうで、今回は、MetaMaskの側から手動で設定する方法を取ったが...
  - サイト側からMetaMaskへ許可を求める方法はどのようになるのだろうか？そもそも可能なのだろうか？ -> 可能。具体的な方法はこのリンクを参考にすればよさそう。[https://docs.metamask.io/guide/getting-started.html#basic-considerations](https://docs.metamask.io/guide/getting-started.html#basic-considerations)
- 設計的な観点で、各ユーザーが、ひとりずつ、コントラクトをデプロイすべきなのだろうか？あるいは、サービス提供者側が一つのコントラクトをデプロイし、(何らかの別途認証を行ったユーザーからのリクエストに応じて、サービス提供者側のminterアカウントで、)同一のコントラクトを使って繰り返しmintすべきなのだろうか？他のNFTサービスでは前者の方法が取られているのか、後者の方法が取られているのか気になっている。 -> 結論としては、後者。サービス提供側が一つのコントラクトをデプロイし、そのコントラクトを用いて、各ユーザーからのチェーン外のリクエストに応じて、サービス提供者側のminterアカウントがmintしているはず。コントラクトのデプロイにはかなり高額なガスが必要だし、OpenSea等の既存サービスで新しいアカウントではじめてトークン作成してみたところ、トークン作成される毎にincrementされるtokenIdに大きな数字が入っていたので、同一コントラクトが繰り返し使用されていると思われる。また、この場合、ユーザーからはMetaMaskを通じて、mintされたトークンが配布される配布先アドレスのみを取得することになり、トランザクションの発行等はサービス提供者側のアカウントで実行する必要がある。つまり、トランザクションの発行は、サービス提供者の秘密鍵等の情報が安全に管理されたバックエンドから行う必要がある。

追加で検証すべき事項

- ERC721が持っているべき機能を、実際にデプロイしたコントラクトから呼び出して使えるかどうか検証しておくべき。
